<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Extractor log:pass con exportaci√≥n</title>
<style>
  body { font-family: Arial; padding: 20px; }
  textarea { width: 100%; height: 300px; margin-top: 10px; }
  input, button { width: 100%; margin-top: 10px; padding: 8px; }
</style>
</head>
<body>

<h2>Extraer log:pass por URL (500MB)</h2>

<input type="file" id="fileInput" accept=".txt">
<input type="text" id="key" placeholder="URL clave (ej: facebook.com)">
<input type="text" id="fileName" placeholder="Nombre del archivo (ej: facebook_combos)">
<button onclick="procesar()">Procesar</button>
<button onclick="exportar()">Exportar a TXT</button>

<textarea id="output" placeholder="login:password"></textarea>

<script>
let resultadoFinal = "";

async function procesar() {
  const file = document.getElementById("fileInput").files[0];
  const key = document.getElementById("key").value.toLowerCase();
  const output = document.getElementById("output");

  if (!file || !key) {
    alert("Selecciona archivo y URL clave");
    return;
  }

  output.value = "";
  resultadoFinal = "";

  const chunkSize = 5 * 1024 * 1024; // 5MB
  let offset = 0;
  let leftover = "";

  while (offset < file.size) {
    const slice = file.slice(offset, offset + chunkSize);
    const text = await slice.text();

    const lines = (leftover + text).split("\n");
    leftover = lines.pop();

    for (const line of lines) {
      if (!line.toLowerCase().includes(key)) continue;

      // Formato: url:login:password
      const parts = line.split(":");
      if (parts.length >= 3) {
        const login = parts[1];
        const pass = parts.slice(2).join(":");
        const combo = `${login}:${pass}\n`;

        resultadoFinal += combo;
        output.value += combo;
      }
    }

    offset += chunkSize;
    await new Promise(r => setTimeout(r, 0)); // evita congelamiento
  }

  alert("Procesamiento terminado");
}

function exportar() {
  if (!resultadoFinal) {
    alert("No hay resultados para exportar");
    return;
  }

  const nameInput = document.getElementById("fileName").value.trim();
  const fileName = nameInput ? nameInput : "resultado";

  const blob = new Blob([resultadoFinal], { type: "text/plain" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = fileName + ".txt";
  a.click();

  URL.revokeObjectURL(url);
}
</script>

</body>
</html>